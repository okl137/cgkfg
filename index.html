<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>采购开发岗</title>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            --text-main: #1d1d1f;
            --text-secondary: #86868b;
            --accent-glow: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.8), transparent 70%);
            --transition-smooth: cubic-bezier(0.2, 0.8, 0.2, 1);
            --font-stack: "SF Pro Display", "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-stack);
            background: #f5f5f7; /* Apple-like light gray/white base */
            color: var(--text-main);
            overflow: hidden; /* Initial state */
            height: 100vh;
            width: 100vw;
        }

        #impact-flash {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.92);
            opacity: 0;
            pointer-events: none;
            z-index: 2500;
            mix-blend-mode: overlay;
        }

        @keyframes impact-flash {
            0% { opacity: 0; }
            18% { opacity: 0.8; }
            100% { opacity: 0; }
        }

        @keyframes impact-shake {
            0% { transform: translate3d(0, 0, 0); }
            12% { transform: translate3d(-10px, 6px, 0); }
            28% { transform: translate3d(14px, -10px, 0); }
            44% { transform: translate3d(-8px, 10px, 0); }
            60% { transform: translate3d(10px, -6px, 0); }
            100% { transform: translate3d(0, 0, 0); }
        }

        body.impact #impact-flash {
            animation: impact-flash 380ms ease-out both;
        }

        body.impact #stack-container {
            animation: impact-shake 360ms linear both;
            filter: blur(1.6px);
        }

        body.impact .ambient-light {
            filter: blur(70px) saturate(1.15);
        }

        /* --- Background Fluid Blobs --- */
        .ambient-light {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 20% 20%, rgba(200, 220, 255, 0.4) 0%, transparent 40%),
                        radial-gradient(circle at 80% 80%, rgba(255, 220, 200, 0.4) 0%, transparent 40%),
                        radial-gradient(circle at 50% 50%, #ffffff 0%, #f5f5f7 100%);
            filter: blur(40px);
            transition: opacity 1s ease;
        }

        /* --- Mode 1: Card Stack --- */
        #stack-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1200px;
            z-index: 100;
            transition: opacity 0.8s var(--transition-smooth), visibility 0.8s;
        }

        .stack-wrapper {
            position: relative;
            width: 320px;
            height: 480px;
            transform-style: preserve-3d;
            transition: transform 0.1s linear; /* For mouse/gyro tilt */
        }

        /* Float Animation */
        @keyframes float-wobble {
            0%, 100% { transform: translateZ(var(--z-depth)) translateY(0) rotate(0deg); }
            33% { transform: translateZ(var(--z-depth)) translateY(-10px) rotate(1deg); }
            66% { transform: translateZ(var(--z-depth)) translateY(5px) rotate(-0.5deg); }
        }

        .card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 30px;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.1),
                inset 0 0 0 1px rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            cursor: pointer;
            
            /* Initial State for Animation */
            opacity: 0;
            transform: translateZ(-200px) scale(0.8);
            
            transition: 
                transform 0.6s var(--transition-smooth), 
                opacity 0.6s ease,
                border-radius 0.8s var(--transition-smooth);
            
            will-change: transform, opacity, border-radius;
        }

        .card.is-drawing {
            transform-origin: 50% 85%;
        }

        .card.is-flying {
            will-change: transform, opacity;
        }

        /* Add floating effect when idle */
        .stack-wrapper:not(:hover) .card.anim-ready {
            animation: float-wobble 6s ease-in-out infinite;
            animation-delay: var(--delay);
        }

        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(255, 255, 255, 0.8) 40deg, transparent 80deg);
            opacity: 0;
            transform: rotate(0deg);
            transition: opacity 0.3s;
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        .card:hover::before {
            opacity: 0.3;
        }

        .card h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #000;
            pointer-events: none;
        }
        
        .card p {
            font-size: 14px;
            color: #555;
            pointer-events: none;
        }

        /* --- Mode 2: Fullscreen Layout --- */
        #fullscreen-content {
            position: relative;
            width: 100%;
            min-height: 100vh;
            opacity: 0;
            visibility: hidden;
            transform: translateY(0);
            filter: none;
            will-change: transform, opacity, filter;
            transition: opacity 1s ease 0.5s, visibility 0s 0.5s, filter 600ms var(--transition-smooth), transform 600ms var(--transition-smooth);
            z-index: 50;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }
        
        /* Reveal animation helper */
        #fullscreen-content.visible {
            opacity: 1;
            visibility: visible;
        }

        #fullscreen-content.building {
            filter: blur(8px);
            transform: scale(1.01);
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            mix-blend-mode: difference; /* High contrast against light bg */
            color: #fff; /* Inverted due to difference */
            transform: translateY(-100%);
            transition: transform 0.8s var(--transition-smooth);
        }

        nav.visible {
            transform: translateY(0);
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-item {
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            opacity: 0.8;
            transition: opacity 0.3s, transform 0.3s;
            position: relative;
        }

        .nav-item:hover {
            opacity: 1;
            transform: scale(1.05);
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: currentColor;
            border-radius: 2px;
        }

        .hamburger {
            display: none;
            font-size: 24px;
            cursor: pointer;
        }

        /* Mobile Nav Drawer */
        #mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(30px);
            z-index: 999;
            transform: translateX(-100%);
            transition: transform 0.6s var(--transition-smooth);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
        }
        
        #mobile-menu.open {
            transform: translateX(0);
        }

        #mobile-menu .nav-item {
            font-size: 24px;
            color: #1d1d1f;
        }

        /* Sections */
        section {
            min-height: 100vh;
            width: 100%;
            padding: 100px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 40px;
            padding: 60px;
            max-width: 1000px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.05);
            opacity: 0; /* Initial for scroll anim */
            transform: translateY(50px);
            transition: opacity 1s ease, transform 1s var(--transition-smooth);
        }

        /* Typography */
        h1 {
            font-size: 56px;
            line-height: 1.1;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -1.5px;
        }

        h2 {
            font-size: 40px;
            font-weight: 600;
            margin-bottom: 30px;
            letter-spacing: -1px;
        }
        
        h3.section-subtitle {
            font-size: 24px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 500;
        }

        p {
            font-size: 18px;
            line-height: 1.6;
            color: #424245;
            margin-bottom: 15px;
        }

        ul {
            list-style: none;
            margin-top: 20px;
        }

        li {
            font-size: 18px;
            margin-bottom: 15px;
            padding-left: 20px;
            position: relative;
            line-height: 1.6;
        }

        li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #007aff;
            font-weight: bold;
        }
        
        .highlight-text {
            color: #007aff;
            font-weight: 600;
        }

        /* Animation Classes */
        .anim-active .glass-panel {
            opacity: 1;
            transform: translateY(0);
        }

        /* Specific Section Animations */
        
        /* Hero */
        #hero .glass-panel {
            clip-path: circle(0% at 50% 50%);
            transform: none;
            opacity: 1;
        }
        #hero.anim-active .glass-panel {
            clip-path: circle(150% at 50% 50%);
            transition: clip-path 1.5s var(--transition-smooth);
        }

        /* Overview - Slide in */
        #overview .glass-panel {
            transform: translateX(100px);
        }
        #overview.anim-active .glass-panel {
            transform: translateX(0);
        }

        /* Development - 3D Flip */
        #development {
            perspective: 1000px;
        }
        #development .glass-panel {
            transform: rotateY(30deg);
            opacity: 0;
        }
        #development.anim-active .glass-panel {
            transform: rotateY(0);
            opacity: 1;
        }

        /* Submission - Ripple Text (simulated via transition delays on children) */
        #submission .glass-panel p {
            opacity: 0;
            transform: translateY(20px);
            transition: 0.5s ease;
        }
        #submission.anim-active .glass-panel p {
            opacity: 1;
            transform: translateY(0);
        }

        /* Preparation - Particles (Simplified visual cue) */
        #preparation .glass-panel {
            box-shadow: 0 0 0 rgba(0, 122, 255, 0);
        }
        #preparation.anim-active .glass-panel {
            animation: pulse-glow 3s infinite;
        }
        @keyframes pulse-glow {
            0% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.05); }
            50% { box-shadow: 0 20px 80px rgba(0, 122, 255, 0.2); }
            100% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.05); }
        }

        /* Operation - Parallax */
        #operation-support {
            overflow: hidden;
        }
        .parallax-bg {
            position: absolute;
            top: -20%;
            left: -20%;
            width: 140%;
            height: 140%;
            background: radial-gradient(circle, rgba(0,122,255,0.05) 0%, transparent 70%);
            transform: translateY(0);
            transition: transform 0.1s linear;
        }

        /* Performance - Glow Up */
        #performance .glass-panel {
            background: linear-gradient(to top, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.3) 100%);
            transform: scale(0.9);
        }
        #performance.anim-active .glass-panel {
            transform: scale(1);
        }

        /* Footer */
        footer {
            padding: 40px;
            text-align: center;
            font-size: 12px;
            color: #aaa;
            padding-bottom: 80px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stack-wrapper {
                width: 80vw;
                height: 60vh;
            }
            
            .nav-links {
                display: none;
            }
            .hamburger {
                display: block;
                color: #000;
            }
            nav {
                mix-blend-mode: normal;
                background: rgba(255,255,255,0.8);
                backdrop-filter: blur(10px);
                color: #000;
            }

            h1 { font-size: 36px; }
            h2 { font-size: 28px; }
            .glass-panel { padding: 30px; border-radius: 20px; }
            section { padding: 80px 15px; }
        }
    </style>
</head>
<body>

    <div class="ambient-light"></div>
    <div id="impact-flash"></div>

    <!-- Mode 1: 3D Card Stack -->
    <div id="stack-container">
        <div class="stack-wrapper" id="stack-wrapper">
            <!-- Cards will be injected via JS or pre-defined here. Pre-defining for semantic structure. -->
            <div class="card" style="z-index: 1;" data-target="performance">
                <h3>绩效激励</h3>
                <p>Target & Incentive</p>
            </div>
            <div class="card" style="z-index: 2;" data-target="operation-support">
                <h3>运营支持</h3>
                <p>Operation Support</p>
            </div>
            <div class="card" style="z-index: 3;" data-target="preparation">
                <h3>资料整备</h3>
                <p>Preparation</p>
            </div>
            <div class="card" style="z-index: 4;" data-target="submission">
                <h3>新品提报</h3>
                <p>Submission</p>
            </div>
            <div class="card" style="z-index: 5;" data-target="development">
                <h3>新品开发</h3>
                <p>Development</p>
            </div>
            <div class="card" style="z-index: 6;" data-target="overview">
                <h3>岗位概述</h3>
                <p>Overview</p>
            </div>
            <div class="card" style="z-index: 7;" data-target="hero">
                <h3>采购开发岗</h3>
                <p>Purchasing Development</p>
                <p style="font-size: 12px; margin-top: 10px; opacity: 0.7;">点击展开</p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav id="navbar">
        <div class="logo">Purchase Dev.</div>
        <div class="nav-links">
            <div class="nav-item" onclick="scrollToSection('hero')">首页</div>
            <div class="nav-item" onclick="scrollToSection('overview')">概述</div>
            <div class="nav-item" onclick="scrollToSection('development')">开发</div>
            <div class="nav-item" onclick="scrollToSection('submission')">提报</div>
            <div class="nav-item" onclick="scrollToSection('preparation')">整备</div>
            <div class="nav-item" onclick="scrollToSection('operation-support')">支持</div>
            <div class="nav-item" onclick="scrollToSection('performance')">绩效</div>
        </div>
        <div class="hamburger" onclick="toggleMobileMenu()">☰</div>
    </nav>

    <div id="mobile-menu">
        <div class="nav-item" onclick="scrollToSection('hero'); toggleMobileMenu()">首页</div>
        <div class="nav-item" onclick="scrollToSection('overview'); toggleMobileMenu()">概述</div>
        <div class="nav-item" onclick="scrollToSection('development'); toggleMobileMenu()">开发</div>
        <div class="nav-item" onclick="scrollToSection('submission'); toggleMobileMenu()">提报</div>
        <div class="nav-item" onclick="scrollToSection('preparation'); toggleMobileMenu()">整备</div>
        <div class="nav-item" onclick="scrollToSection('operation-support'); toggleMobileMenu()">支持</div>
        <div class="nav-item" onclick="scrollToSection('performance'); toggleMobileMenu()">绩效</div>
        <div class="nav-item" onclick="toggleMobileMenu()" style="font-size: 16px; margin-top: 30px;">关闭</div>
    </div>

    <!-- Mode 2: Fullscreen Content -->
    <main id="fullscreen-content">
        
        <section id="hero">
            <div class="glass-panel">
                <h3 class="section-subtitle">采购开发岗</h3>
                <h1>驱动创新。<br>开拓蓝海。<br>成就爆款。</h1>
                <p>采购部开发岗核心职责是驱动公司产品线的开拓与优化，以前端市场数据为导向，结合公司战略需求，完成从新品开发、供应商寻源、成本核价到资料整备的全流程工作，并为运营上架提供充分支持。岗位需具备敏锐的市场洞察力、数据分析能力、供应商谈判及项目管理能力。</p>
            </div>
        </section>

        <section id="overview">
            <div class="glass-panel">
                <h3 class="section-subtitle">一、岗位概述</h3>
                <h2>不止于采购。<br>更是战略驱动。</h2>
                <p>采购部开发岗核心职责是驱动公司产品线的开拓与优化，以前端市场数据为导向，结合公司战略需求，完成从新品开发、供应商寻源、成本核价到资料整备的全流程工作，并为运营上架提供充分支持。岗位需具备敏锐的市场洞察力、数据分析能力、供应商谈判及项目管理能力。</p>
            </div>
        </section>

        <section id="development">
            <div class="glass-panel">
                <h3 class="section-subtitle">二、核心工作流程</h3>
                <h2>数据驱动。爆款新生。</h2>
                <div style="margin-top: 30px;">
                    <p class="highlight-text">1. 新品开发与供应商寻源</p>
                    <ul>
                        <li><strong>数据驱动开发</strong>：基于各销售平台前端数据（如销量、热度、趋势）、公司新品规划、市场蓝海分析，进行新品开发。</li>
                        <li><strong>开发方向</strong>：
                            <br>· 爆款跟卖：识别市场现有爆款，在合规前提下进行针对性开发。
                            <br>· 元素拓展：解构现有爆款核心卖点与元素，进行组合、迭代或跨品类创新。
                        </li>
                        <li><strong>供应商开拓</strong>：根据开发方向，自主开发新供应商或与现有合作供应商洽谈新品合作，确保货源竞争力。</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="submission">
            <div class="glass-panel">
                <h2>严谨提报。潜力甄选。</h2>
                <div style="margin-top: 30px;">
                    <p class="highlight-text">2. 新品提报与内部审核</p>
                    <ul>
                        <li><strong>资料整理</strong>：按公司标准表格系统化整理新品信息（包括产品描述、对手链接、初步成本、市场数据等）。</li>
                        <li><strong>内部审核流程</strong>：
                            <br>· 查重：由审核员比对现有货盘，如有重复款，则判断产品生命周期（如超过2年可考虑重新上架）。
                            <br>· 新品评审：若无重复，审核员基于提报的对手链接及市场数据分析，评估其市场潜力、竞争度、利润率等，决定是否通过。
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="preparation">
            <div class="glass-panel">
                <h2>自动化极致。交付完美。</h2>
                <div style="margin-top: 30px;">
                    <p class="highlight-text">3. 审核通过后的产品资料整备</p>
                    <ul>
                        <li><strong>自动化处理</strong>：利用公司内部工具/自动化程序，完成：
                            <br>· 参考图片处理（尺寸、格式统一）。
                            <br>· 多平台售价自动计算（根据成本、运费、税率、目标利润率等）。
                            <br>· 生成标准化的产品文档（含详细规格、卖点、关键词、价格体系等）。
                        </li>
                        <li><strong>归档与交付</strong>：将最终资料（文档、图片）整理至结构化文件夹，确保运营同事能高效、清晰地获取全部上架所需信息。</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="operation-support">
            <div class="parallax-bg"></div>
            <div class="glass-panel" style="position: relative; z-index: 1;">
                <h2>快速响应。深度保障。</h2>
                <div style="margin-top: 30px;">
                    <p class="highlight-text">4. 支持运营驱动的开发需求（核价与深度寻源）</p>
                    <ul>
                        <li><strong>需求响应</strong>：当运营提出新品开发需求时，采购首先介入。</li>
                        <li><strong>初步核价</strong>：根据运营提供的样品或描述，在大致价格范围内寻找备选货源，提供初步成本及对应前端售价估算，供运营进行首次核价筛选。</li>
                        <li><strong>深度执行</strong>：对运营核价通过的品项，进行精细化供应商比对，全面评估：
                            <br>· 产品质量（可索样验证）
                            <br>· 最终成交价与最小起订量
                            <br>· 交货期与供应稳定性
                            <br>· 供应商配合度与信誉
                        </li>
                        <li><strong>供应链备份</strong>：对于上架后出单良好的新品，主动开发备选供应商，以防范供应中断风险。</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="performance">
            <div class="glass-panel">
                <h3 class="section-subtitle">三、绩效与激励机制</h3>
                <h2>目标明确。激励长远。</h2>
                <div style="margin-top: 30px;">
                    <ul>
                        <li><strong>开发数量基础目标</strong>：设定月度基础开发量（如100款/月），作为工作量考核基线。</li>
                        <li><strong>爆款产出质量目标</strong>：在基础开发量中，设定爆款或高潜力款的数量目标（如5款/月），具体比例可根据平台与阶段动态调整。</li>
                        <li><strong>爆款开发提成方案</strong>：
                            <br>· 提成触发条件：所开发新品在后续销售中达到公司定义的“爆款”标准（销量/销售额阈值）。
                            <br>· 核算周期与选择权：
                                <br>&nbsp;&nbsp;1. 短期追踪：可选择爆款产生当月及次月中，取单月最高毛利的月份作为提成核算基准。
                                <br>&nbsp;&nbsp;2. 长期追踪：若新品上市后需时间积累，可从开发完成的第四个月起算，在之后一年内，首次达到爆款标准的月份，以其当月毛利为核算基准。
                            <br>· 提成计算：在选定的核算月份，按该爆款所产生的毛利额，按公司既定比例（如X%）计提奖金。
                            <br>· 时间限制：此提成权益有效期通常为自开发完成起12个月内。
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <footer>
            <p>说明：以上流程与机制为通用框架，具体数据需根据公司实际业务规模、平台特性及发展阶段进行校准与填充。</p>
        </footer>

    </main>

    <script>
        // Configuration
        const config = {
            tiltSensitivity: 25, // degrees
            mobileTiltSensitivity: 0.4,
            cardStagger: 200, // ms
            cardZOffset: 40 // px
        };

        // State
        let isFullscreen = false;
        let mouseX = 0;
        let mouseY = 0;
        let currentRotateX = 0;
        let currentRotateY = 0;

        // Elements
        const stackContainer = document.getElementById('stack-container');
        const stackWrapper = document.getElementById('stack-wrapper');
        const cards = document.querySelectorAll('.card');
        const fullscreenContent = document.getElementById('fullscreen-content');
        const navbar = document.getElementById('navbar');
        const body = document.body;

        // --- Initialization ---
        window.onload = () => {
            animateEntrance();
            setupInteractions();
            setupIntersectionObserver();
        };

        // --- 1. Card Stack Entrance ---
        function animateEntrance() {
            cards.forEach((card, index) => {
                // Determine Z depth
                // Hero (last in DOM, index 6) -> Z=0
                // Performance (first in DOM, index 0) -> Z=-300
                const depth = (index - 6) * 50; // 0->-300, 6->0
                
                // Set custom properties for animation
                card.style.setProperty('--z-depth', `${depth}px`);
                card.style.setProperty('--delay', `${index * -0.5}s`); // Randomize start phase
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = `translateZ(${depth}px) scale(1)`;
                    
                    // Add float animation after entrance
                    setTimeout(() => {
                        card.classList.add('anim-ready');
                    }, 800);
                    
                }, index * config.cardStagger);
            });
        }

        // --- 2. Tilt Interaction ---
        function setupInteractions() {
            // Desktop Mouse
            document.addEventListener('mousemove', (e) => {
                if (isFullscreen) return;
                
                const x = (e.clientX / window.innerWidth) - 0.5;
                const y = (e.clientY / window.innerHeight) - 0.5;
                
                // Target rotation
                const targetRotateY = x * config.tiltSensitivity; 
                const targetRotateX = -y * config.tiltSensitivity; 
                
                stackWrapper.style.transform = `rotateX(${targetRotateX}deg) rotateY(${targetRotateY}deg)`;
            });

            // Mobile Gyro
            if (window.DeviceOrientationEvent) {
                // Note: Permission request required on iOS 13+. 
                // We'll try to listen; if no data, it just won't tilt.
                window.addEventListener('deviceorientation', (e) => {
                    if (isFullscreen) return;
                    
                    let tiltX = e.beta * config.mobileTiltSensitivity;
                    let tiltY = e.gamma * config.mobileTiltSensitivity;
                    
                    // Clamp
                    tiltX = Math.max(-30, Math.min(30, tiltX));
                    tiltY = Math.max(-30, Math.min(30, tiltY));
                    
                    stackWrapper.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
                });
            }

            // Click to Expand
            cards.forEach(card => {
                card.addEventListener('click', (e) => {
                    if (isFullscreen) return;
                    expandCard(card);
                });
            });
        }

        function expandCard(clickedCard) {
            isFullscreen = true;
            stackContainer.style.pointerEvents = 'none';
            cards.forEach(c => c.classList.remove('anim-ready'));

            const rect = clickedCard.getBoundingClientRect();
            const targetScale = Math.max(window.innerWidth / rect.width, window.innerHeight / rect.height) * 1.04;

            stackWrapper.style.transition = 'transform 320ms var(--transition-smooth)';
            stackWrapper.style.transform = 'rotateX(0) rotateY(0)';

            const cardList = Array.from(cards);
            const others = cardList.filter(c => c !== clickedCard);
            const othersSorted = others
                .map(c => ({ card: c, index: cardList.indexOf(c) }))
                .sort((a, b) => b.index - a.index)
                .map(x => x.card);

            clickedCard.classList.add('is-drawing');
            clickedCard.style.zIndex = '999';

            cardList.forEach((card, idx) => {
                card.style.transition = 'transform 220ms ease, opacity 220ms ease';
                card.style.opacity = '1';
                const zDepthRaw = card.style.getPropertyValue('--z-depth') || '0px';
                const zDepth = parseFloat(zDepthRaw) || 0;
                const deckY = (6 - idx) * 2;
                card.style.transform = `translate3d(0, ${deckY}px, ${zDepth}px)`;
            });

            requestAnimationFrame(() => {
                clickedCard.style.transition = 'transform 420ms cubic-bezier(0.16, 1, 0.3, 1), box-shadow 420ms ease';
                clickedCard.style.transform = `translate3d(96px, -210px, 420px) rotateZ(-12deg) rotateY(10deg) scale(1.05)`;
                clickedCard.style.boxShadow = '0 34px 70px rgba(0,0,0,0.22)';
            });

            const flyStart = 200;
            const flyStagger = 70;
            othersSorted.forEach((card, i) => {
                setTimeout(() => {
                    card.classList.add('is-flying');
                    card.style.transition = 'transform 520ms cubic-bezier(0.2, 0.9, 0.2, 1), opacity 520ms ease';
                    const randX = (Math.random() - 0.5) * window.innerWidth * 0.45;
                    const randY = (Math.random() - 0.2) * window.innerHeight * 0.35;
                    const rX = (Math.random() - 0.5) * 40;
                    const rY = (Math.random() - 0.5) * 40;
                    const rZ = (Math.random() - 0.5) * 70;
                    card.style.transform = `translate3d(${randX}px, ${randY}px, 420px) rotateX(${rX}deg) rotateY(${rY}deg) rotateZ(${rZ}deg) scale(1.08)`;
                    card.style.opacity = '0';
                }, flyStart + i * flyStagger);
            });

            const slamStart = flyStart + othersSorted.length * flyStagger + 200;
            setTimeout(() => {
                body.classList.add('impact');
                setTimeout(() => body.classList.remove('impact'), 360);

                clickedCard.style.transition = 'transform 150ms cubic-bezier(0.1, 0.9, 0.2, 1), border-radius 220ms ease, box-shadow 220ms ease, background 220ms ease, border 220ms ease';
                clickedCard.style.transform = `translate3d(0, 0, 40px) rotateZ(0deg) rotateY(0deg) scale(${targetScale})`;
                clickedCard.style.borderRadius = '0';
                clickedCard.style.background = 'rgba(255, 255, 255, 1)';
                clickedCard.style.border = '0';
                clickedCard.style.boxShadow = '0 64px 130px rgba(0,0,0,0.18)';

                setTimeout(() => {
                    clickedCard.style.transition = 'opacity 320ms ease';
                    clickedCard.style.opacity = '0';
                }, 140);
            }, slamStart);

            const revealStart = slamStart + 260;
            setTimeout(() => {
                stackContainer.style.opacity = '0';
                stackContainer.style.visibility = 'hidden';

                body.style.overflowY = 'auto';
                fullscreenContent.classList.add('visible', 'building');

                fullscreenContent.scrollTop = 0;
                window.scrollTo(0, 0);
                setActiveNav('hero');

                setTimeout(() => {
                    fullscreenContent.classList.remove('building');
                    navbar.classList.add('visible');
                    const hero = document.getElementById('hero');
                    if (hero) hero.scrollIntoView({ behavior: 'auto', block: 'start' });
                }, 420);

                handleScroll();
            }, revealStart);
        }

        // --- 3. Scroll Animations (Intersection Observer) ---
        function setupIntersectionObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('anim-active');
                        
                        // Handle specific text staggered anims if needed
                        if (entry.target.id === 'submission') {
                            const lines = entry.target.querySelectorAll('li');
                            lines.forEach((line, i) => {
                                line.style.transitionDelay = `${i * 100}ms`;
                            });
                        }
                    }
                });
            }, { threshold: 0.15 });

            document.querySelectorAll('section').forEach(section => {
                observer.observe(section);
            });
            
            // Parallax handler
            window.addEventListener('scroll', handleScroll);
        }

        function handleScroll() {
            const scrolled = window.pageYOffset;
            
            // Operation Support Parallax
            const opSection = document.getElementById('operation-support');
            const parallaxBg = opSection.querySelector('.parallax-bg');
            
            if (opSection && parallaxBg) {
                const rect = opSection.getBoundingClientRect();
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    // Visible
                    const yPos = (window.innerHeight - rect.top) * 0.2;
                    parallaxBg.style.transform = `translateY(${yPos}px)`;
                }
            }
        }

        // --- Navigation ---
        const navOrder = ['hero', 'overview', 'development', 'submission', 'preparation', 'operation-support', 'performance'];
        function setActiveNav(id) {
            const items = document.querySelectorAll('#navbar .nav-links .nav-item');
            items.forEach((item, idx) => {
                item.classList.toggle('active', navOrder[idx] === id);
            });
        }

        window.scrollToSection = (id) => {
            const el = document.getElementById(id);
            if (el) {
                el.scrollIntoView({ behavior: 'smooth' });
                setActiveNav(id);
            }
        };

        window.toggleMobileMenu = () => {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('open');
        };

    </script>
</body>
</html>
